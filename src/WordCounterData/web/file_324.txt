5059141 <h>( http : **33;5179;TOOLONG... <h> site. <p> Windows Server includes W32Time, the Time Service tool that is required by the Kerberos authentication protocol. The Windows Time service makes sure that all computers in an organization that are running the Microsoft Windows 2000 Server operating system or later versions use a common time. <p> To guarantee appropriate common time usage, the Windows Time service uses a hierarchical relationship that controls authority, and the Windows Time service does not allow for loops. By default, Windows-based computers use the following hierarchy : <p> All client desktop computers nominate the authenticating domain controller as their in-bound time partner. <p> All member servers follow the same process that client desktop computers follow. <p> All domain controllers in a domain nominate the primary domain controller( PDC) operations master as their in-bound time partner. <p> All PDC operations masters follow the hierarchy of domains in the selection of their in-bound time partner. <p> In this hierarchy, the PDC operations master at the root of the forest becomes authoritative for the organization. We highly recommend that you configure the @ @ @ @ @ @ @ @ @ @ source. When you configure the authoritative time server to sync with an Internet time source, there is no authentication. We also recommend that you reduce your time correction settings for your servers and stand-alone clients. These recommendations provide more accuracy and security to your domain. <h> Configuring the Windows Time service to use an internal hardware clock <p> To have us configure the Windows Time service to use an internal hardware clock for you, go to the " Fix it for me " section. If you prefer to fix this problem yourself, go to the " Let me fix it myself " section. <h> Fix it for me <p> To fix this problem automatically, click the Fix it button or link. Click Run in the File Download dialog box, and follow the steps in the Fix it wizard. <h> Let me fix it myself <p> Important This section, method, or task contains steps that tell you how to modify the registry. However, serious problems might occur if you modify the registry incorrectly. @ @ @ @ @ @ @ @ @ @. For added protection, back up the registry before you modify it. Then, you can restore the registry if a problem occurs. For more information the registry, click the following article number to view the article in the Microsoft Knowledge Base : <p> To configure the PDC master without using an external time source, change the announce flag on the PDC master. The PDC master is the server that holds the forest root PDC master role for the domain. This configuration forces the PDC master to announce itself as a reliable time source and uses the built-in complementary metal oxide semiconductor( CMOS) clock. To configure the PDC master by using an internal hardware clock, follow these steps : <p> In the right-pane, right-click AnnounceFlags, and then click Modify. <p> In Edit DWORD Value, type A in the Value data box, and then click OK. <p> Close Registry Editor. <p> At the command prompt, type the following command to restart the Windows Time service, and then press Enter : <p> @ @ @ @ @ @ @ @ @ @ this image Expand this image <p> Note The PDC master must not be configured to synchronize with itself. For more information about why the PDC master must not be configured to synchronize with itself, see Request For Comment( RFC) 1305. If the PDC master is configured to synchronize with itself, the following events are logged in the System log : <p> Event Type : Warning Event Source : W32Time Event Category : None Event ID : 47 Computer : ComputerName Description : Time Provider NtpClient : No valid response has been received from manually configured peer NTPserverIPAddress after 8 attempts to contact it. This peer will be discarded as a time source and NtpClient will attempt to discover a new peer with this DNS name. For more information, see Help and Support Center at http : //support.microsoft.com. <p> Event Type : Error Event Source : W32Time Event Category : None Event ID : 29 Computer : ComputerName Description : The time provider NtpClient is configured to acquire time from one or more time sources, however none of the sources @ @ @ @ @ @ @ @ @ @ will be made for 15 minutes. NtpClient has no source of accurate time. For more information, see Help and Support Center at http : //support.microsoft.com. <p> When the PDC master runs without using an external time source, the following event is logged in the Application log : <p> Event Type : Error Event Source : W32Time Event Category : None Event ID : 12 Description : Time Provider NtpClient : This machine is configured to use the domain hierarchy to determine its time source, but it is the PDC emulator for the domain at the root of the forest, so there is no machine above it in the domain hierarchy to use as a time source. It is recommended that you either configure a reliable time service in the root domain, or manually configure the PDC to synchronize with an external time source. Otherwise, this machine will function as the authoritative time source in the domain hierarchy. If an external time source is not configured or used for this computer, you may choose to disable the NtpClient @ @ @ @ @ @ @ @ @ @ external time source, and it can be ignored. <h> Configuring the Windows Time service to use an external time source <p> To have us help you configure an internal time server to synchronize with an external time source, go to the " Fix it for me " section. If you prefer to fix this problem yourself, go to the " Let me fix it myself " section. <h> Fix it for me <p> To fix this problem automatically, click the Fix it button or link. Click Run in the File Download dialog box, and follow the steps in the Fix it wizard. <p> If an authoritative time server that is configured to use an AnnounceFlag value of 0x5 does not synchronize with an upstream time server, a client server may not correctly synchronize with the authoritative time server when the time synchronization between the authoritative time server and the upstream time server resumes. Therefore, if you have a poor network connection or other concerns that may cause time synchronization failure of the authoritative server to an upstream @ @ @ @ @ @ @ @ @ @ to 0x5. <p> If an authoritative time server that is configured to use an AnnounceFlag value of 0x5 and to synchronize with an upstream time server at a fixed interval that is specified in SpecialPollInterval, a client server may not correctly synchronize with the authoritative time server after the authoritative time server restarts. Therefore, if you configure your authoritative time server to synchronize with an upstream NTP server at a fixed interval that is specified in SpecialPollInterval, set the AnnounceFlag value to 0xA instead of 0x5. <p> In the pane on the right, right-click NtpServer, and then click Modify. <p> In Edit Value, type Peers in the Value data box, and then click OK. <p> Collapse this image Expand this image <p> Note Peers is a placeholder for a space-delimited list of peers from which your computer obtains time stamps. Each DNS name that is listed must be unique. You must append, 0x1 to the end of each DNS name. If you do not append, 0x1 to the end of each DNS name @ @ @ @ @ @ @ @ @ @ not take effect. <p> Note TimeInSeconds is a placeholder for a reasonable value, such as 1 hour( 3600) or 30 minutes( 1800). The value that you select will depend on the poll interval, network condition, and external time source. <p> Note TimeInSeconds is a placeholder for a reasonable value, such as 1 hour( 3600) or 30 minutes( 1800). The value that you select will depend on the poll interval, network condition, and external time source. <p> Close Registry Editor. <p> At the command prompt, type the following command to restart the Windows Time service, and then press Enter : <h> Troubleshooting <p> For the Windows Time service to function correctly, the networking infrastructure must function correctly. The most common problems that affect the Windows Time service include the following : <p> There is a problem with TCP/IP connectivity, such as a dead gateway. <p> The Name Resolution service is not working correctly. <p> The network is experiencing high volume delays, especially when @ @ @ @ @ @ @ @ @ @ links. <p> The Windows Time service is trying to synchronize with inaccurate time sources. <p> We recommend that you use the Netdiag.exe utility to troubleshoot network-related issues. Netdiag.exe is part of the Windows Server 2003 Support Tools package. See Tools Help for a complete list of command-line parameters that you can use with Netdiag.exe. If your problem is still not solved, you can turn on the Windows Time service debug log. Because the debug log can contain very detailed information, we recommend that you contact Microsoft Customer Support Services when you turn on the Windows Time service debug log. <p> For a complete list of Microsoft Customer Support Services telephone numbers and information about support costs, go to the Contact Microsoft website. <p> Collapse this image Expand this image <p> Note In special cases, charges that are ordinarily incurred for support calls may be canceled if a Microsoft Support Professional determines that a specific update will resolve your problem. The usual support costs will apply to additional support questions and issues that do not qualify for the @ @ @ @ @ @ @ @ @ @ is configured to be a reliable time source is identified as the root of the Windows Time service. The root of the Windows Time service is the authoritative server for the domain. Typically, it is configured to retrieve time from an external NTP server or hardware device. A time server can be configured as a reliable time source to optimize how time is transferred throughout the domain hierarchy. If a domain controller is configured to be a reliable time source, the Net Logon service announces that domain controller as a reliable time source when it logs on to the network. When other domain controllers look for a time source to synchronize with, they select a reliable source first, if one is available. <h> Manually-specified synchronization <p> With manually-specified synchronization, you can designate a single peer or list of peers that a computer obtains time from. If the computer is not a member of a domain, it must be manually configured to synchronize with a specified time source. By default, a computer that is a member @ @ @ @ @ @ @ @ @ @ hierarchy. Manually-specified synchronization is most useful for the forest root of the domain or for computers that are not joined to a domain. When you manually specify an external NTP server to synchronize with the authoritative computer for your domain, you provide reliable time. However, to provide high accuracy and security to your domain, we recommend that you configure the authoritative computer for your domain to synchronize with a hardware clock. <p> Without a hardware time source, W32time is configured as an NTP type. You must reconfigure the MaxPosPhaseCorrection and MaxNegPhaseCorrection registry entries. The recommended value should be 15 minutes or even less, depending on time source, network condition, and security requirement. This requirement also applies to any reliable time source that is configured as the forest root time source in the time sync subnet. For more information about these registry entries, see the " Windows Time service registry entries " section in this article. <p> Collapse this image Expand this image <p> Note Manually-specified time sources are not authenticated unless a specific @ @ @ @ @ @ @ @ @ @ time sources are vulnerable to attacks. Also, if a computer synchronizes with a manually-specified source instead of its authenticating domain controller, the two computers might be out of synchronization. This scenario causes Kerberos authentication to fail and could also cause other actions that require network authentication to fail, such as printing or file sharing. If only the forest root is configured to synchronize with an external source, all other computers within the forest remain synchronized with one another. This configuration makes replay attacks difficult. <h> All available synchronization mechanisms <p> The " all available synchronization mechanisms " option is the most valuable synchronization method for users on a network. This method enables synchronization with the domain hierarchy and may also provide an alternative time source if the domain hierarchy becomes unavailable, depending on the configuration. If the client can not synchronize time with the domain hierarchy, the time source automatically falls back to the time source that is specified by the NtpServer setting. This method of synchronization is most likely to provide accurate time to clients @ @ @ @ @ @ @ @ @ @ registry entries are located under <p> **36;5214;TOOLONG... <p> : <p> Collapse this table Expand this table <p> Registry Entry <p> MaxPosPhaseCorrection <p> Path <p> **36;5252;TOOLONG... <p> Notes <p> This entry specifies the largest positive time correction in seconds that the service makes. If the service determines that a change that is larger than this is required, the service logs an event.( 0xFFFFFFFF is a special case that means always make a time correction.) The default value for domain members is 0xFFFFFFFF. The default value for stand-alone clients and servers is 54,000 or 15 hours. <p> Collapse this table Expand this table <p> Registry Entry <p> MaxNegPhaseCorrection <p> Path <p> **36;5290;TOOLONG... <p> Notes <p> This entry specifies the largest negative time correction in seconds that the service makes. If the service determines that a change that is larger than this is required, the service logs an event instead.( -1 is a special case that means always make a time correction.) The default value for domain members is 0xFFFFFFFF. The default value for stand-alone @ @ @ @ @ @ @ @ @ @ Collapse this table Expand this table <p> Registry Entry <p> MaxPollInterval <p> Path <p> **36;5328;TOOLONG... <p> Note <p> This entry specifies the largest interval, in log seconds, that is allowed for the system polling interval. Although a system must poll according to the scheduled interval, a provider can refuse to produce samples when they are requested. The default value for domain members is 10. The default value for stand-alone clients and servers is 15. <p> This entry specifies the special poll interval in seconds for manual peers. When the SpecialInterval 0x1 flag is enabled, W32Time uses this poll interval instead of a poll interval that is determined by the operating system. The default value on domain members is 3,600. The default value on stand-alone clients and servers is 604,800. <p> Collapse this table Expand this table <p> Registry Entry <p> MaxAllowedPhaseOffset <p> Path <p> **36;5366;TOOLONG... <p> Note <p> This entry specifies the maximum offset, in seconds, for which W32Time tries to adjust the computer clock by using the clock rate. When the offset @ @ @ @ @ @ @ @ @ @ clock directly. The default value for domain members is 300. 
